<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Código de Verificação - Lotus Clinic</title>
    <link href="../static/css/bootstrap-icons.css" rel="stylesheet">
    <link href="../static/css/bootstrap.min.css" rel="stylesheet">
    <link href="../static/css/login.css" rel="stylesheet">

    <link href="../static/css/templatemo-kind-heart-charity.css" rel="stylesheet">

    <style>
        /* ===================================
   VERIFICATION CODE SECTION
===================================== */

        .verification-section {
            background: linear-gradient(135deg, #e8f5f3 0%, #f5f5f5 100%);
            min-height: calc(100vh - 200px);
            display: flex;
            align-items: center;
            padding: 3rem 0;
            position: relative;
            overflow: hidden;
        }

        .verification-section::before {
            content: '';
            position: absolute;
            top: -80px;
            right: -80px;
            width: 400px;
            height: 400px;
            background: #5bc1ac;
            border-radius: 50%;
            opacity: 0.6;
        }

        .verification-section::after {
            content: '';
            position: absolute;
            bottom: -100px;
            left: -100px;
            width: 450px;
            height: 450px;
            background: #b8b8b8;
            border-radius: 50%;
            opacity: 0.4;
        }

        .verification-container {
            position: relative;
            z-index: 2;
            max-width: 500px;
            margin: 0 auto;
        }

        .verification-card {
            background: linear-gradient(145deg, #737373 0%, #5a5a5a 100%);
            border-radius: 20px;
            padding: 0;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .verification-header {
            background: #6b6b6b;
            padding: 1rem;
            text-align: center;
            border-bottom: 3px solid rgba(255, 255, 255, 0.1);
        }

        .verification-header h4 {
            color: white;
            font-size: 24px;
            font-weight: 500;
            margin: 0;
        }

        .verification-body {
            padding: 2rem;
        }

        .verification-text {
            color: white;
            text-align: center;
            margin-bottom: 1.5rem;
            font-size: 14px;
        }

        .code-inputs {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .code-input {
            width: 60px;
            height: 70px;
            background: #5a5a5a;
            border: none;
            border-radius: 15px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
            outline: none;
            transition: all 0.3s;
        }

        .code-input:focus {
            background: #4a4a4a;
            box-shadow: 0 0 0 3px rgba(91, 193, 172, 0.5);
            transform: scale(1.05);
        }

        .code-input::placeholder {
            color: #888;
        }

        .verification-buttons {
            display: flex;
            justify-content: center;
        }

        .btn-verification {
            margin: 10px;
            background: #4aa896;
            border: none;
            border-radius: 25px;
            color: white;
            padding: 12px 50px;
            font-weight: 500;
            transition: all 0.3s;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-verification:hover {
            background: #3d8f7f;
            transform: translateY(-2px);
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .verification-container {
                margin: 0 1rem;
            }

            .code-inputs {
                gap: 0.5rem;
            }

            .code-input {
                width: 50px;
                height: 60px;
                font-size: 20px;
            }
        }

        @media (max-width: 480px) {
            .code-input {
                width: 45px;
                height: 55px;
                font-size: 18px;
            }
        }
    </style>

</head>


<body>
    <header class="site-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-12 d-flex flex-wrap">
                    <p class="d-flex me-4 mb-0"> <i class="bi-geo-alt me-2"></i> Rua Mariano Procópio, 37 - Rio de
                        Janeiro </p>
                    <p class="d-flex mb-0"> <i class="bi-envelope me-2"></i> <a href="mailto:contato@lotusclinic.com">
                            contato@lotusclinic.com </a> </p>
                </div>
                <div class="col-lg-3 col-12 ms-auto d-lg-block d-none">
                    <ul class="social-icon">
                        <li class="social-icon-item"> <a href="#" class="social-icon-link bi-twitter"></a> </li>
                        <li class="social-icon-item"> <a href="#" class="social-icon-link bi-facebook"></a> </li>
                        <li class="social-icon-item"> <a href="#" class="social-icon-link bi-instagram"></a> </li>
                        <li class="social-icon-item"> <a href="#" class="social-icon-link bi-youtube"></a> </li>
                        <li class="social-icon-item"> <a href="#" class="social-icon-link bi-whatsapp"></a> </li>
                    </ul>
                </div>
            </div>
        </div>
    </header>

    <nav class="navbar navbar-expand-lg bg-light shadow-lg">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="../static/images/Lotus.png" class="logo img-fluid" alt="Lotus Clinic">
                <span class="simonetta-regular"> Lotus <small class="simonetta-black">Private medical clinic</small>
                </span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"> <a class="nav-link click-scroll" href="index.html#top">Inicio</a> </li>
                    <li class="nav-item"> <a class="nav-link click-scroll" href="index.html#section_2">Sobre</a> </li>
                    <li class="nav-item"> <a class="nav-link click-scroll" href="index.html#section_3">Agende</a> </li>
                    <li class="nav-item"> <a class="nav-link click-scroll" href="index.html#section_4">Contato</a> </li>
                    <li class="nav-item ms-3"> <a class="nav-link custom-btn custom-border-btn btn"
                            href="login.html">Entrar</a> </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- VERIFICATION CODE SECTION -->
    <section class="verification-section">
        <div class="verification-container">
            <div class="verification-card">
                <div class="verification-header">
                    <h4>Esqueceu sua senha?</h4>
                </div>
                <div class="verification-body">
                    <p class="verification-text">Um código foi enviado para seu e-mail</p>
                    <form id="verificationForm">
                        <div class="code-inputs">
                            <input type="text" class="code-input" maxlength="1" id="code1" autofocus>
                            <input type="text" class="code-input" maxlength="1" id="code2">
                            <input type="text" class="code-input" maxlength="1" id="code3">
                            <input type="text" class="code-input" maxlength="1" id="code4">
                        </div>
                        <div class="verification-buttons">
                            <button type="submit" class="btn-verification">
                                voltar
                            </button>
                            <button type="submit" class="btn-verification">
                                continuar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <footer class="site-footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-12 mb-4">
                    <img src="../static/images/Lotus.png" class="logo img-fluid" alt="">
                </div>

                <div class="col-lg-4 col-md-6 col-12 mb-4">
                    <h5 class="site-footer-title mb-3">Conteúdos</h5>
                    <ul class="footer-menu">
                        <li class="footer-menu-item"><a href="#" class="footer-menu-link">Sobre nós</a></li>
                        <li class="footer-menu-item"><a href="#" class="footer-menu-link">Algum erro na página?</a></li>
                        <li class="footer-menu-item"><a href="#" class="footer-menu-link">Agende sua consulta</a></li>
                    </ul>
                </div>

                <div class="col-lg-4 col-md-6 col-12 mx-auto">
                    <h5 class="site-footer-title mb-3">Informações de contato</h5>
                    <p class="text-white d-flex mb-2">
                        <i class="bi-geo-alt me-2"></i>
                        Rua Mariano Procópio, 37 - Rio de Janeiro, RJ
                    </p>
                    <p class="text-white d-flex mb-2">
                        <i class="bi-telephone me-2"></i>
                        <a href="tel:21997925722" class="site-footer-link">
                            (21) 9 9792-5722
                        </a>
                    </p>
                    <p class="text-white d-flex">
                        <i class="bi-envelope me-2"></i>
                        <a href="mailto:contato@lotusclinic.com" class="site-footer-link">
                            contato@lotusclinic.com
                        </a>
                    </p>
                </div>
            </div>
        </div>

        <div class="site-footer-bottom">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6 col-md-7 col-12">
                        <p class="copyright-text mb-0">Copyright © 2025 <a href="#">Lotus Clinic</a></p>
                    </div>
                    <div class="col-lg-6 col-md-5 col-12 d-flex justify-content-center align-items-center mx-auto">
                        <ul class="social-icon">
                            <li class="social-icon-item">
                                <a href="#" class="social-icon-link bi-twitter"></a>
                            </li>
                            <li class="social-icon-item">
                                <a href="#" class="social-icon-link bi-facebook"></a>
                            </li>
                            <li class="social-icon-item">
                                <a href="#" class="social-icon-link bi-instagram"></a>
                            </li>
                            <li class="social-icon-item">
                                <a href="#" class="social-icon-link bi-whatsapp"></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script src="../static/js/bootstrap.bundle.min.js"></script>
    <script src="../static/js/bootstrap.bundle.min.js"></script>
<script>
    // Recuperar email da sessão
    const emailRecuperacao = sessionStorage.getItem('email_recuperacao');
    
    if (!emailRecuperacao) {
        alert('⚠️ Sessão expirada. Solicite o código novamente.');
        window.location.href = '/password';
    }

    // Auto-focus no próximo campo ao digitar
    const inputs = document.querySelectorAll('.code-input');

    inputs.forEach((input, index) => {
        input.addEventListener('input', (e) => {
            if (e.target.value.length === 1 && index < inputs.length - 1) {
                inputs[index + 1].focus();
            }
        });

        input.addEventListener('keydown', (e) => {
            if (e.key === 'Backspace' && e.target.value === '' && index > 0) {
                inputs[index - 1].focus();
            }
        });

        // Permite apenas números
        input.addEventListener('keypress', (e) => {
            if (!/[0-9]/.test(e.key)) {
                e.preventDefault();
            }
        });
    });

    // Processar o formulário
    document.getElementById('verificationForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const code = Array.from(inputs).map(input => input.value).join('');

        if (code.length !== 4) {
            alert('⚠️ Por favor, digite o código completo de 4 dígitos.');
            return;
        }

        // Desabilitar botões durante verificação
        const btnContinuar = document.querySelector('.btn-verification:last-child');
        const textoOriginal = btnContinuar.textContent;
        btnContinuar.disabled = true;
        btnContinuar.textContent = 'Verificando...';

        try {
            const response = await fetch('/api/verificar-codigo', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    email: emailRecuperacao,
                    codigo: code
                })
            });

            const data = await response.json();

            if (response.ok && data.success) {
                // Armazenar token para redefinir senha
                sessionStorage.setItem('token_recuperacao', data.token);
                
                alert('✅ Código verificado! Agora você pode criar uma nova senha.');
                
                // Aqui você pode criar uma página password-reset.html
                // ou usar um prompt para nova senha:
                const novaSenha = prompt('Digite sua nova senha (mínimo 6 caracteres):');
                const confirmaSenha = prompt('Confirme sua nova senha:');
                
                if (novaSenha && confirmaSenha) {
                    if (novaSenha === confirmaSenha && novaSenha.length >= 6) {
                        // Redefinir senha
                        const resetResponse = await fetch('/api/redefinir-senha', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                email: emailRecuperacao,
                                token: data.token,
                                nova_senha: novaSenha,
                                confirma_senha: confirmaSenha
                            })
                        });
                        
                        const resetData = await resetResponse.json();
                        
                        if (resetResponse.ok && resetData.success) {
                            alert('✅ Senha redefinida com sucesso!');
                            sessionStorage.clear();
                            window.location.href = '/login';
                        } else {
                            alert('❌ ' + (resetData.error || 'Erro ao redefinir senha'));
                        }
                    } else {
                        alert('❌ Senhas não coincidem ou senha muito curta');
                    }
                }
            } else {
                alert('❌ ' + (data.error || 'Código incorreto'));
                btnContinuar.disabled = false;
                btnContinuar.textContent = textoOriginal;
                
                // Limpar inputs
                inputs.forEach(input => input.value = '');
                inputs[0].focus();
            }
        } catch (error) {
            console.error('Erro:', error);
            alert('❌ Erro ao conectar com o servidor');
            btnContinuar.disabled = false;
            btnContinuar.textContent = textoOriginal;
        }
    });

    // Botão voltar
    document.querySelector('.btn-verification:first-child').addEventListener('click', function(e) {
        e.preventDefault();
        if (confirm('Deseja voltar? O código atual será invalidado.')) {
            sessionStorage.clear();
            window.location.href = '/password';
        }
    });
</script>
<div vw class="enabled">
    <div vw-access-button class="active"></div>
    <div vw-plugin-wrapper>
      <div class="vw-plugin-top-wrapper"></div>
    </div>
  </div>
  <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
  <script>
    new window.VLibras.Widget('https://vlibras.gov.br/app');
  </script>
</body>

</html>